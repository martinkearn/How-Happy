$(document).on("change",".btn-file :file",function(){var n=$(this),t=n.get(0).files?n.get(0).files.length:1,i=n.val().replace(/\\/g,"/").replace(/.*\//,"");n.trigger("fileselect",[t,i])});$(document).ready(function(){function n(){var t,i,n,f;for(r(),t=new FormData,i=$('input[type="file"]')[0].files,n=0;n<i.length;n++)t.append("file_"+n,i[n]);f=$("form").serializeArray();$.each(f,function(n,i){t.append(i.name,i.value)});$.ajax({type:"POST",url:"/home/Emotion",contentType:!1,processData:!1,data:t,success:function(n){u(n)},error:function(n){alert("There was error uploading files!");console.log(n.statusText)}})}function r(){function r(){$("#result").append($("<img>",{id:"photo",src:n.result}));$("#result").css("width",$("#photo").width())}$("#resultDetails").html('Working on it <i class="fa fa-circle-o-notch fa-spin"><\/i>');$("#result").html("");$("#form-file-input").hide();$("#form-submit-button").hide();$("#intro-text").hide();$("#Emotion").show();$("h1").css("font-size","5rem");$("#home-container").css("padding-top","0px");$("#Emotion").css("font-size","5rem");var t=document.getElementById("file"),i=t.files[0],n=new FileReader;n.onload=r;n.readAsDataURL(i)}function u(n){var r=JSON.stringify(n),i=JSON.parse(r);console.log("emotion:"+i.emotion+" / intent:"+i.intent+" / ordinal:"+i.ordinal);switch(i.intent){case"MostEmotional":t(i,1);break;case"LeastEmotional":f(i);break;case"SortedByEmotion":e(i);break;case"SpecificPosition":i.ordinal==-1?t(i,1):t(i,i.ordinal);break;default:i.intent!==""?$("#resultDetails").html("<span>I could not figure out your intent, please rephrase the question<\/span>"):$("#resultDetails").html("<span>What would you like to know? Ask me a question about the emotions of the people in this picture<\/span>")}$("body").css("background-color","#"+i.themeColour);$(".rect").css("border-color","#"+i.themeColour);$(".rank").css("color","#"+i.themeColour);$(".popover-title").css("background-color","#"+i.themeColour)}function t(n,t){$("#resultDetails").html("<span>We found "+n.faces.length+" faces with "+n.emotion+' <i class="fa '+n.faEmotionClass+" fa-lg\"><\/i>. We're showing number "+t+"<\/span>");var r=n.faces[t-1];i(t-1,r)}function f(n){$("#resultDetails").html("<span>We found "+n.faces.length+" faces with "+n.emotion+' <i class="fa '+n.faEmotionClass+' fa-lg"><\/i>. This is the last one<\/span>');var t=n.faces[n.faces.length-1];i(n.faces.length-1,t)}function e(n){$("#resultDetails").html("<span>We found "+n.faces.length+" faces. We sorted them by "+n.emotion+' <i class="fa '+n.faEmotionClass+' fa-lg"><\/i><\/span>');$.each(n.faces,function(n,t){i(n,t)})}function i(n,t){var i=document.createElement("div"),r,u;i.className="rect";i.style.height=t.faceRectangle.height+"px";i.style.width=t.faceRectangle.width+"px";i.style.left=t.faceRectangle.left+"px";i.style.top=t.faceRectangle.top+"px";i.id="rect"+n;r=document.createElement("div");r.className="rank";r.innerHTML="#"+(n+1);i.appendChild(r);$("#result").append(i);u="Happiness: "+Number(t.scores.happiness.toFixed(2))+"<br>Fear: "+Number(t.scores.fear.toFixed(2))+"<br>Anger: "+Number(t.scores.anger.toFixed(2))+"<br>Contempt: "+Number(t.scores.contempt.toFixed(2))+"<br>Disgust: "+Number(t.scores.disgust.toFixed(2))+"<br>Neutral: "+Number(t.scores.neutral.toFixed(2))+"<br>Sadness: "+Number(t.scores.sadness.toFixed(2))+"<br>Surprise: "+Number(t.scores.surprise.toFixed(2));$("#rect"+n).popover({title:"How is #"+(n+1)+" feeling?",content:u,html:"true",trigger:"click"})}$("#form-file-input").show();$("#form-submit-button").show();$("#intro-text").show();$("#Emotion").hide();$("#upload-button").click(function(){n()});$("#Emotion").change(function(){n()});$("#LuisQuery").keydown(function(t){t.keyCode==13&&n()});$(".btn-file :file").on("fileselect",function(n,t,i){var u=$(this).parents(".input-group").find(":text"),r=t>1?t+" files selected":i;u.length?u.val(r):r&&alert(r)})});