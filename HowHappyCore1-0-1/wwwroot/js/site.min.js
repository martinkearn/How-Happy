$(document).on("change",".btn-file :file",function(){var n=$(this),t=n.get(0).files?n.get(0).files.length:1,i=n.val().replace(/\\/g,"/").replace(/.*\//,"");n.trigger("fileselect",[t,i])});$(document).ready(function(){function t(){var t,i,n,r;for(u(),t=new FormData,i=$('input[type="file"]')[0].files,n=0;n<i.length;n++)t.append("file_"+n,i[n]);r=$("form").serializeArray();$.each(r,function(n,i){t.append(i.name,i.value)});$.ajax({type:"POST",url:"/home/Emotion",contentType:!1,processData:!1,data:t,success:function(n){f(n)},error:function(n){alert("There was error uploading files!");console.log(n.statusText)}})}function u(){function r(){$("#result").append($("<img>",{id:"photo",src:n.result}));$("#result").css("width",$("#photo").width())}$("#resultDetails").html('Working on it <i class="fa fa-circle-o-notch fa-spin"><\/i>');$("#result").html("");$("#form-file-input").hide();$("#form-submit-button").hide();$("#intro-text").hide();$("#Emotion").show();$("#LuisQuery").show();$("h1").css("font-size","5rem");$("#home-container").css("padding-top","0px");$("#Emotion").css("font-size","5rem");var t=document.getElementById("file"),i=t.files[0],n=new FileReader;n.onload=r;n.readAsDataURL(i)}function f(n){var r=JSON.stringify(n),t=JSON.parse(r);console.log("emotion:"+t.emotion+" / intent:"+t.intent+" / ordinal:"+t.ordinal);switch(t.intent){case"MostEmotional":i(t,1);break;case"LeastEmotional":e(t);break;case"SortedByEmotion":o(t);break;case"SpecificPosition":t.ordinal==-1?i(t,1):i(t,t.ordinal);break;default:t.intent!==""?$("#resultDetails").html("<span>I could not figure out your intent, please rephrase the question<\/span>"):$("#resultDetails").html("<span>What would you like to know? Ask me a question about the emotions of the people in this picture<\/span>")}$("body").css("background-color","#"+t.themeColour);$(".rect").css("border-color","#"+t.themeColour);$(".rank").css("color","#"+t.themeColour);$(".popover-title").css("background-color","#"+t.themeColour)}function i(t,i){$("#resultDetails").html("<span>We found "+t.faces.length+" faces showing "+t.emotion+". Their average "+t.emotion+" is "+n(t.averageEmotionScore)+' <i class="fa '+t.faEmotionClass+" fa-lg\"><\/i>. We're showing number "+i+"<\/span>");var u=t.faces[i-1];r(i-1,u)}function e(t){$("#resultDetails").html("<span>We found "+t.faces.length+" faces showing "+t.emotion+". Their average "+t.emotion+" is "+n(t.averageEmotionScore)+' <i class="fa '+t.faEmotionClass+' fa-lg"><\/i>. This is the last one<\/span>');var i=t.faces[t.faces.length-1];r(t.faces.length-1,i)}function o(t){$("#resultDetails").html("<span>We found "+t.faces.length+" faces. We sorted them by "+t.emotion+". Their average "+t.emotion+" is "+n(t.averageEmotionScore)+' <i class="fa '+t.faEmotionClass+' fa-lg"><\/i><\/span>');$.each(t.faces,function(n,t){r(n,t)})}function r(t,i){var r=document.createElement("div"),u,f;r.className="rect";r.style.height=i.faceRectangle.height+"px";r.style.width=i.faceRectangle.width+"px";r.style.left=i.faceRectangle.left+"px";r.style.top=i.faceRectangle.top+"px";r.id="rect"+t;u=document.createElement("div");u.className="rank";u.innerHTML="#"+(t+1);r.appendChild(u);$("#result").append(r);f="Happiness: "+n(i.scores.happiness)+"<br>Fear: "+n(i.scores.fear)+"<br>Anger: "+n(i.scores.anger)+"<br>Contempt: "+n(i.scores.contempt)+"<br>Disgust: "+n(i.scores.disgust)+"<br>Neutral: "+n(i.scores.neutral)+"<br>Sadness: "+n(i.scores.sadness)+"<br>Surprise: "+n(i.scores.surprise);$("#rect"+t).popover({title:"How is #"+(t+1)+" feeling?",content:f,html:"true",trigger:"click"})}function n(n){var t=Number(n.toFixed(2));return t*100+"&#37;"}$("#form-file-input").show();$("#form-submit-button").show();$("#intro-text").show();$("#Emotion").hide();$("#LuisQuery").hide();$("#upload-button").click(function(){t()});$("#Emotion").change(function(){t()});$("#LuisQuery").keydown(function(n){n.keyCode==13&&t()});$(".btn-file :file").on("fileselect",function(n,t,i){var u=$(this).parents(".input-group").find(":text"),r=t>1?t+" files selected":i;u.length?u.val(r):r&&alert(r)})});